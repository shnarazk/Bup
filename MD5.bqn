#!/usr/bin/env cbqn
envâ†{vâ‡â‰>âŠ‘âˆ˜âŠâŸœ'='âŠ¸(â†‘â‹ˆ1âŠ¸â†“âˆ˜â†“)Â¨{-Â¬(Â¬Ã—1++`)ğ•©=@+10}âŠ¸âŠ”1âŠ‘â€¢SH<"env"â‹„Varâ‡{âŠâŸœğ•©âŠ¸âŠâŸœ(âˆ¾âŸœğ•¨)Ëv}}
# util â† â€¢Import "/util.bqn"âˆ¾Ëœ"." env.VarâŒ¾â‹ˆ "BQN_LIB"
âŸ¨Md5âŸ© â‡

modulo â† 2â‹†8
SwapByteOrder â† âŒ½Â·â¥ŠÂ·<Ë˜âˆ˜â€¿8âŠ¸â¥Š

Encode32 â† {âˆ¾âŒ½((âŸ¨8â€¿'i',1â€¿'u'âŸ©â€¢bit._cast)âˆ˜â‹ˆâˆ˜{127<ğ•© ? ğ•©-modulo ; ğ•©})Â¨{ğ•©+16Ã—ğ•¨}Â´Ë˜âˆ˜â€¿2â¥Š"0123456789ABCDEF"âŠğ•©}
ToString â† {â¥Š((âŠ‘âŸœ"0123456789abcdef"Â¨Â·16âŠ¸(âŒŠâˆ˜(Ã·Ëœ)â‹ˆ|)Â·{ğ•¨+2Ã—ğ•©}Â´>)Ë˜SwapByteOrder)ğ•©}
t â† Encode32Â¨âŸ¨
  "00000000"
  "D76AA478","E8C7B756","242070DB","C1BDCEEE"
  "F57C0FAF","4787C62A","A8304613","FD469501"
  "698098D8","8B44F7AF","FFFF5BB1","895CD7BE"
  "6B901122","FD987193","A679438E","49B40821"
  "F61E2562","C040B340","265E5A51","E9B6C7AA"
  "D62F105D","02441453","D8A1E681","E7D3FBC8"
  "21E1CDE6","C33707D6","F4D50D87","455A14ED"
  "A9E3E905","FCEFA3F8","676F02D9","8D2A4C8A"
  "FFFA3942","8771F681","6D9D6122","FDE5380C"
  "A4BEEA44","4BDECFA9","F6BB4B60","BEBFBC70"
  "289B7EC6","EAA127FA","D4EF3085","04881D05"
  "D9D4D039","E6DB99E5","1FA27CF8","C4AC5665"
  "F4292244","432AFF97","AB9423A7","FC93A039"
  "655B59C3","8F0CCC92","FFEFF47D","85845DD1"
  "6FA87E4F","FE2CE6E0","A3014314","4E0811A1"
  "F7537E82","BD3AF235","2AD7D2BB","EB86D391"
âŸ©
# "ToString encode32 8FFF0000" util.Debug ToString Encode32 "8FFF0000"
aâ€¿bâ€¿câ€¿d â† Encode32Â¨âŸ¨"67452301","EFCDAB89","98BADCFE","10325476"âŸ©
F â† {xâ€¿yâ€¿z : z 32â€¿32 â€¢bit._xor x 32â€¿32 â€¢bit._and y 32â€¿32 â€¢bit._xor z}
# F â† {xâ€¿yâ€¿z : (x 32â€¿32 â€¢bit._and y) 32â€¿32 â€¢bit._or z 32â€¿32 â€¢bit._and 32â€¿1 â€¢bit._not x}
G â† {xâ€¿yâ€¿z : y 32â€¿32 â€¢bit._xor z 32â€¿32 â€¢bit._and x 32â€¿32 â€¢bit._xor y}
# G â† {xâ€¿yâ€¿z : (x 32â€¿32 â€¢bit._and z) 32â€¿32 â€¢bit._or y 32â€¿32 â€¢bit._and 32â€¿1 â€¢bit._not z}
H â† {xâ€¿yâ€¿z : x 32â€¿32 â€¢bit._xor y 32â€¿32 â€¢bit._xor z}
J â† {xâ€¿yâ€¿z : y 32â€¿32 â€¢bit._xor x 32â€¿32 â€¢bit._or 32â€¿1 â€¢bit._not z}
Add32 â† 32â€¿1â€¢bit._add

ToMd5 â† {
  !âˆ§Â´(255âŠ¸â‰¥-âŸœ@)Â¨message â† ğ•©
  msg_len_bits â† 8Ã—â‰ ğ•©
  msg â† âˆ¾{âŸ¨8â€¿'u',1â€¿'u'âŸ©â€¢bit._cast â‹ˆğ•©-@}Â¨ğ•©
  msg âˆ¾âŸœâŸ¨0,0,0,0,0,0,0,1âŸ© â†©
  msg â†© {ğ•©âˆ¾8â†‘0}â€¢_while_(448â‰ 512|â‰ )msg
  msg â†© msg{
    ğ•©âˆ¾âŸ¨8,1â€¿'u'âŸ©â€¢bit._castâ‹ˆ{127<ğ•© ? ğ•©-modulo ; ğ•©}ğ•¨
  }Â´2âŠ‘{câ€¿vâ€¿l : âŸ¨-Â¬c,vâŒŠâˆ˜Ã·modulo,lâˆ¾Ëœmodulo|vâŸ©}â€¢_while_(0<âŠ‘)8â€¿msg_len_bitsâ€¿âŸ¨âŸ©
  (â‰ msg)!0â‰¡512|â‰ msg
  abcd â† aâ€¿bâ€¿câ€¿d{block ğ•Š aâ€¿bâ€¿câ€¿d :
    word_block â† â¥Š<Ë˜âˆ˜â€¿32â¥Šblock
    _op â† {bâ€¿câ€¿dâ€¿kâ€¿sâ€¿i ğ”½ _ğ•£ a : b Add32 sâŠ¸âŒ½â¼a Add32(ğ”½ bâ€¿câ€¿d)Add32(kâŠ‘word_block)Add32 iâŠ‘t}
    {
      a bâ€¿câ€¿dâ€¿(0+ğ•©)â€¿07â€¿(1+ğ•©)âŠ¸(F _op) â†©
      d aâ€¿bâ€¿câ€¿(1+ğ•©)â€¿12â€¿(2+ğ•©)âŠ¸(F _op) â†©
      c dâ€¿aâ€¿bâ€¿(2+ğ•©)â€¿17â€¿(3+ğ•©)âŠ¸(F _op) â†©
      b câ€¿dâ€¿aâ€¿(3+ğ•©)â€¿22â€¿(4+ğ•©)âŠ¸(F _op) â†©
      4+ğ•©
    }â€¢_while_(16âŠ¸>)0
    # "phase1" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    {
      a bâ€¿câ€¿dâ€¿(16| 1+ğ•©)â€¿05â€¿(1+ğ•©)âŠ¸(G _op) â†©
      d aâ€¿bâ€¿câ€¿(16| 6+ğ•©)â€¿09â€¿(2+ğ•©)âŠ¸(G _op) â†©
      c dâ€¿aâ€¿bâ€¿(16|11+ğ•©)â€¿14â€¿(3+ğ•©)âŠ¸(G _op) â†©
      b câ€¿dâ€¿aâ€¿(16|16+ğ•©)â€¿20â€¿(4+ğ•©)âŠ¸(G _op) â†©
      4+ğ•©
    }â€¢_while_(32âŠ¸>)16
    # "phase2" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    {xâ€¿y :
      a bâ€¿câ€¿dâ€¿(16| 3+y)â€¿04â€¿(1+x)âŠ¸(H _op) â†©
      d aâ€¿bâ€¿câ€¿(16| 6+y)â€¿11â€¿(2+x)âŠ¸(H _op) â†©
      c dâ€¿aâ€¿bâ€¿(16| 9+y)â€¿16â€¿(3+x)âŠ¸(H _op) â†©
      b câ€¿dâ€¿aâ€¿(16|12+y)â€¿23â€¿(4+x)âŠ¸(H _op) â†©
      âŸ¨4+x,12+yâŸ©
    }â€¢_while_(48>âŠ‘)32â€¿2
    # "phase3" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    {xâ€¿y :
      a bâ€¿câ€¿dâ€¿(16|   y)â€¿06â€¿(1+x)âŠ¸(J _op) â†©
      d aâ€¿bâ€¿câ€¿(16| 7+y)â€¿10â€¿(2+x)âŠ¸(J _op) â†©
      c dâ€¿aâ€¿bâ€¿(16|14+y)â€¿15â€¿(3+x)âŠ¸(J _op) â†©
      b câ€¿dâ€¿aâ€¿(16|21+y)â€¿21â€¿(4+x)âŠ¸(J _op) â†©
      âŸ¨4+x,28+yâŸ©
    }â€¢_while_(64>âŠ‘)48â€¿0
    # "phase4" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    ğ•© Add32Â¨ aâ€¿bâ€¿câ€¿d
  }Â´âŒ½<Ë˜âˆ˜â€¿512â¥Šmsg
  âŒ½âŒ¾(â¥Šâˆ˜(<Ë˜)âˆ˜â€¿8âŠ¸â¥Š)Â¨abcd
}

Md5 â† âˆ¾ToStringÂ¨âˆ˜ToMd5

!"d41d8cd98f00b204e9800998ecf8427e"â‰¡ Md5 ""
!"0cc175b9c0f1b6a831c399e269772661"â‰¡ Md5 "a"
!"900150983cd24fb0d6963f7d28e17f72"â‰¡ Md5 "abc"
!"f96b697d7cb7938d525a2f31aaf161d0"â‰¡ Md5 "message digest"
!"c3fcd3d76192e4007dfb496cca67e13b"â‰¡ Md5 "abcdefghijklmnopqrstuvwxyz"
!"d174ab98d277d9f5a5611c2c9f419d9f"â‰¡ Md5 "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
!"57edf4a22be3c955ac49da2e2107b67a"â‰¡ Md5 "12345678901234567890123456789012345678901234567890123456789012345678901234567890"

# â€¢Show ((âˆ¾âŸœ(8âŠ¸Ã—)â‰ )âŠ¸â‹ˆ(â‰â—‹â‹ˆ)Md5)"message digest"
# â€¢Show ((âˆ¾âŸœ(8âŠ¸Ã—)â‰ )âŠ¸â‹ˆ(â‰â—‹â‹ˆ)Md5)"abcdefghijklmnopqrstuvwxyz"
# â€¢Show ((âˆ¾âŸœ(8âŠ¸Ã—)â‰ )âŠ¸â‹ˆ(â‰â—‹â‹ˆ)Md5)"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
