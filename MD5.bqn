#!/usr/bin/env cbqn
envâ†{vâ‡â‰>âŠ‘âˆ˜âŠâŸœ'='âŠ¸(â†‘â‹ˆ1âŠ¸â†“âˆ˜â†“)Â¨{-Â¬(Â¬Ã—1++`)ğ•©=@+10}âŠ¸âŠ”1âŠ‘â€¢SH<"env"â‹„Varâ‡{âŠâŸœğ•©âŠ¸âŠâŸœ(âˆ¾âŸœğ•¨)Ëv}}
# util â† â€¢Import "/util.bqn"âˆ¾Ëœ"." env.VarâŒ¾â‹ˆ "BQN_LIB"
âŸ¨Md5âŸ© â‡

modulo â† 2â‹†8
SwapByteOrder â† âŒ½Â·â¥ŠÂ·<Ë˜âˆ˜â€¿8âŠ¸â¥Š
SwapBitOrder â† â¥ŠÂ·âŒ½Ë˜âˆ˜â€¿8âŠ¸â¥Š

Encode32 â† {âˆ¾âŒ½(âŒ½âˆ˜(âŸ¨8â€¿'i',1â€¿'u'âŸ©â€¢bit._cast)âˆ˜â‹ˆâˆ˜{127<ğ•© ? ğ•©-modulo ; ğ•©})Â¨{ğ•©+16Ã—ğ•¨}Â´Ë˜âˆ˜â€¿2â¥Š"0123456789ABCDEF"âŠğ•©}
# Encode32 â† {âˆ¾âŒ½(âŒ½âˆ˜(8âŠ¸â†‘)âˆ˜(âŸ¨16â€¿'u',1â€¿'u'âŸ©â€¢bit._cast)âˆ˜â‹ˆ)Â¨{ğ•©+16Ã—ğ•¨}Â´Ë˜âˆ˜â€¿2â¥Š"0123456789ABCDEF"âŠğ•©}
ToString â† {â¥Š((âŠ‘âŸœ"0123456789abcdef"Â¨Â·16âŠ¸(âŒŠâˆ˜(Ã·Ëœ)â‹ˆ|)Â·{ğ•¨+2Ã—ğ•©}Â´Â·âŒ½>)Ë˜SwapByteOrder)ğ•©}
t â† Encode32Â¨âŸ¨
  "00000000"
  "D76AA478","E8C7B756","242070DB","C1BDCEEE"
  "F57C0FAF","4787C62A","A8304613","FD469501"
  "698098D8","8B44F7AF","FFFF5BB1","895CD7BE"
  "6B901122","FD987193","A679438E","49B40821"
  "F61E2562","C040B340","265E5A51","E9B6C7AA"
  "D62F105D","02441453","D8A1E681","E7D3FBC8"
  "21E1CDE6","C33707D6","F4D50D87","455A14ED"
  "A9E3E905","FCEFA3F8","676F02D9","8D2A4C8A"
  "FFFA3942","8771F681","6D9D6122","FDE5380C"
  "A4BEEA44","4BDECFA9","F6BB4B60","BEBFBC70"
  "289B7EC6","EAA127FA","D4EF3085","04881D05"
  "D9D4D039","E6DB99E5","1FA27CF8","C4AC5665"
  "F4292244","432AFF97","AB9423A7","FC93A039"
  "655B59C3","8F0CCC92","FFEFF47D","85845DD1"
  "6FA87E4F","FE2CE6E0","A3014314","4E0811A1"
  "F7537E82","BD3AF235","2AD7D2BB","EB86D391"
âŸ©
# "ToString encode32 8FFF0000" util.Debug ToString Encode32 "8FFF0000"
aâ€¿bâ€¿câ€¿d â† Encode32Â¨âŸ¨"67452301","EFCDAB89","98BADCFE","10325476"âŸ©
F â† {xâ€¿yâ€¿z : (x 32â€¿32 â€¢bit._and y) 32â€¿32 â€¢bit._or ((32â€¿32 â€¢bit._not x) 32â€¿32 â€¢bit._and z)}
G â† {xâ€¿yâ€¿z : (x 32â€¿32 â€¢bit._and z) 32â€¿32 â€¢bit._or (y 32â€¿32 â€¢bit._and (1â€¿1 â€¢bit._not z))}
H â† {xâ€¿yâ€¿z : x 32â€¿32 â€¢bit._xor y 32â€¿32 â€¢bit._xor z}
J â† {xâ€¿yâ€¿z : y 32â€¿32 â€¢bit._xor (x 32â€¿32 â€¢bit._or (1â€¿1 â€¢bit._not z))}
Add32 â† SwapBitOrderâˆ˜(32â€¿1â€¢bit._add)â—‹SwapBitOrder

ToMd5 â† {
  !âˆ§Â´(255âŠ¸â‰¥-âŸœ@)Â¨message â† ğ•©
  msg_len_bits â† 8Ã—â‰ ğ•©
  msg â† âˆ¾{âŒ½âŸ¨8â€¿'u',1â€¿'u'âŸ©â€¢bit._cast â‹ˆğ•©-@}Â¨ğ•©
  msg âˆ¾âŸœâŸ¨1,0,0,0,0,0,0,0âŸ© â†©
  msg â†© {ğ•©âˆ¾8â†‘0}â€¢_while_(448â‰ 512|â‰ )msg
  msg â†© msg{
    ğ•©âˆ¾âŒ½8â†‘âŸ¨16,1â€¿'u'âŸ©â€¢bit._castâ‹ˆğ•¨
  }Â´2âŠ‘{câ€¿vâ€¿l : âŸ¨-Â¬c,vâŒŠâˆ˜Ã·modulo,lâˆ¾Ëœmodulo|vâŸ©}â€¢_while_(0<âŠ‘)8â€¿msg_len_bitsâ€¿âŸ¨âŸ©
  (â‰ msg)!0â‰¡512|â‰ msg
  abcd â† aâ€¿bâ€¿câ€¿d{block ğ•Š aâ€¿bâ€¿câ€¿d :
    word_block â† â¥Š<Ë˜âˆ˜â€¿32â¥Šblock
    # backup â† aâ€¿bâ€¿câ€¿d
    Op1 â† {bâ€¿câ€¿dâ€¿kâ€¿sâ€¿i ğ•Š a : b Add32 sâŠ¸âŒ½â¼âŒ¾SwapBitOrder a Add32(F bâ€¿câ€¿d)Add32(kâŠ‘word_block)Add32 iâŠ‘t}
    # "0â€¿14â€¿15âŠ‘X" util.Debug ToStringÂ¨âŸ¨0âŠ‘word_block,14âŠ‘word_block,15âŠ‘word_blockâŸ©
    # "a+f" util.Debug ToStringÂ¨âŸ¨a Add32(F bâ€¿câ€¿d)âŸ©
    # "a+f+X+T" util.Debug ToString a Add32(F bâ€¿câ€¿d)Add32(0âŠ‘word_block)Add32 1âŠ‘t
    a bâ€¿câ€¿dâ€¿00â€¿07â€¿01âŠ¸Op1 â†©
    # "step1" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    d aâ€¿bâ€¿câ€¿01â€¿12â€¿02âŠ¸Op1 â†©
    c dâ€¿aâ€¿bâ€¿02â€¿17â€¿03âŠ¸Op1 â†©
    b câ€¿dâ€¿aâ€¿03â€¿22â€¿04âŠ¸Op1 â†©
    # "step4" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    a bâ€¿câ€¿dâ€¿04â€¿07â€¿05âŠ¸Op1 â†©
    d aâ€¿bâ€¿câ€¿05â€¿12â€¿06âŠ¸Op1 â†©
    c dâ€¿aâ€¿bâ€¿06â€¿17â€¿07âŠ¸Op1 â†©
    b câ€¿dâ€¿aâ€¿07â€¿22â€¿08âŠ¸Op1 â†©
    # "step8" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    a bâ€¿câ€¿dâ€¿08â€¿07â€¿09âŠ¸Op1 â†©
    d aâ€¿bâ€¿câ€¿09â€¿12â€¿10âŠ¸Op1 â†©
    c dâ€¿aâ€¿bâ€¿10â€¿17â€¿11âŠ¸Op1 â†©
    b câ€¿dâ€¿aâ€¿11â€¿22â€¿12âŠ¸Op1 â†©
    # "stepC" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    a bâ€¿câ€¿dâ€¿12â€¿07â€¿13âŠ¸Op1 â†©
    d aâ€¿bâ€¿câ€¿13â€¿12â€¿14âŠ¸Op1 â†©
    c dâ€¿aâ€¿bâ€¿14â€¿17â€¿15âŠ¸Op1 â†©
    b câ€¿dâ€¿aâ€¿15â€¿22â€¿16âŠ¸Op1 â†©
    # "phase1" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    Op2 â† {bâ€¿câ€¿dâ€¿kâ€¿sâ€¿i ğ•Š a : b Add32 sâŠ¸âŒ½â¼âŒ¾SwapBitOrder a Add32(G bâ€¿câ€¿d)Add32(kâŠ‘word_block)Add32 iâŠ‘t}
    a bâ€¿câ€¿dâ€¿01â€¿05â€¿17âŠ¸Op2 â†©
    d aâ€¿bâ€¿câ€¿06â€¿09â€¿18âŠ¸Op2 â†©
    c dâ€¿aâ€¿bâ€¿11â€¿14â€¿19âŠ¸Op2 â†©
    b câ€¿dâ€¿aâ€¿00â€¿20â€¿20âŠ¸Op2 â†©

    a bâ€¿câ€¿dâ€¿05â€¿05â€¿21âŠ¸Op2 â†©
    d aâ€¿bâ€¿câ€¿10â€¿09â€¿22âŠ¸Op2 â†©
    c dâ€¿aâ€¿bâ€¿15â€¿14â€¿23âŠ¸Op2 â†©
    b câ€¿dâ€¿aâ€¿04â€¿20â€¿24âŠ¸Op2 â†©

    a bâ€¿câ€¿dâ€¿09â€¿05â€¿25âŠ¸Op2 â†©
    d aâ€¿bâ€¿câ€¿14â€¿09â€¿26âŠ¸Op2 â†©
    c dâ€¿aâ€¿bâ€¿03â€¿14â€¿27âŠ¸Op2 â†©
    b câ€¿dâ€¿aâ€¿08â€¿20â€¿28âŠ¸Op2 â†©

    a bâ€¿câ€¿dâ€¿13â€¿05â€¿29âŠ¸Op2 â†©
    d aâ€¿bâ€¿câ€¿02â€¿09â€¿30âŠ¸Op2 â†©
    c dâ€¿aâ€¿bâ€¿07â€¿14â€¿31âŠ¸Op2 â†©
    b câ€¿dâ€¿aâ€¿12â€¿20â€¿32âŠ¸Op2 â†©
    # "phase2" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    Op3 â† {bâ€¿câ€¿dâ€¿kâ€¿sâ€¿i ğ•Š a : b Add32 sâŠ¸âŒ½â¼âŒ¾SwapBitOrder a Add32(H bâ€¿câ€¿d)Add32(kâŠ‘word_block)Add32 iâŠ‘t}
    a bâ€¿câ€¿dâ€¿05â€¿04â€¿33âŠ¸Op3 â†©
    d aâ€¿bâ€¿câ€¿08â€¿11â€¿34âŠ¸Op3 â†©
    c dâ€¿aâ€¿bâ€¿11â€¿16â€¿35âŠ¸Op3 â†©
    b câ€¿dâ€¿aâ€¿14â€¿23â€¿36âŠ¸Op3 â†©

    a bâ€¿câ€¿dâ€¿01â€¿04â€¿37âŠ¸Op3 â†©
    d aâ€¿bâ€¿câ€¿04â€¿11â€¿38âŠ¸Op3 â†©
    c dâ€¿aâ€¿bâ€¿07â€¿16â€¿39âŠ¸Op3 â†©
    b câ€¿dâ€¿aâ€¿10â€¿23â€¿40âŠ¸Op3 â†©

    a bâ€¿câ€¿dâ€¿13â€¿04â€¿41âŠ¸Op3 â†©
    d aâ€¿bâ€¿câ€¿00â€¿11â€¿42âŠ¸Op3 â†©
    c dâ€¿aâ€¿bâ€¿03â€¿16â€¿43âŠ¸Op3 â†©
    b câ€¿dâ€¿aâ€¿06â€¿23â€¿44âŠ¸Op3 â†©

    a bâ€¿câ€¿dâ€¿09â€¿04â€¿45âŠ¸Op3 â†©
    d aâ€¿bâ€¿câ€¿12â€¿11â€¿46âŠ¸Op3 â†©
    c dâ€¿aâ€¿bâ€¿15â€¿16â€¿47âŠ¸Op3 â†©
    b câ€¿dâ€¿aâ€¿02â€¿23â€¿48âŠ¸Op3 â†©
    # "phase3" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    Op4 â† {bâ€¿câ€¿dâ€¿kâ€¿sâ€¿i ğ•Š a : b Add32 sâŠ¸âŒ½â¼âŒ¾SwapBitOrder a Add32(J bâ€¿câ€¿d)Add32(kâŠ‘word_block)Add32 iâŠ‘t}
    a bâ€¿câ€¿dâ€¿00â€¿06â€¿49âŠ¸Op4 â†©
    d aâ€¿bâ€¿câ€¿07â€¿10â€¿50âŠ¸Op4 â†©
    c dâ€¿aâ€¿bâ€¿14â€¿15â€¿51âŠ¸Op4 â†©
    b câ€¿dâ€¿aâ€¿05â€¿21â€¿52âŠ¸Op4 â†©

    a bâ€¿câ€¿dâ€¿12â€¿06â€¿53âŠ¸Op4 â†©
    d aâ€¿bâ€¿câ€¿03â€¿10â€¿54âŠ¸Op4 â†©
    c dâ€¿aâ€¿bâ€¿10â€¿15â€¿55âŠ¸Op4 â†©
    b câ€¿dâ€¿aâ€¿01â€¿21â€¿56âŠ¸Op4 â†©

    a bâ€¿câ€¿dâ€¿08â€¿06â€¿57âŠ¸Op4 â†©
    d aâ€¿bâ€¿câ€¿15â€¿10â€¿58âŠ¸Op4 â†©
    c dâ€¿aâ€¿bâ€¿06â€¿15â€¿59âŠ¸Op4 â†©
    b câ€¿dâ€¿aâ€¿13â€¿21â€¿60âŠ¸Op4 â†©

    a bâ€¿câ€¿dâ€¿04â€¿06â€¿61âŠ¸Op4 â†©
    d aâ€¿bâ€¿câ€¿11â€¿10â€¿62âŠ¸Op4 â†©
    c dâ€¿aâ€¿bâ€¿02â€¿15â€¿63âŠ¸Op4 â†©
    b câ€¿dâ€¿aâ€¿09â€¿21â€¿64âŠ¸Op4 â†©
    # "phase4" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    ğ•© Add32Â¨ aâ€¿bâ€¿câ€¿d
  }Â´âŒ½<Ë˜âˆ˜â€¿512â¥Šmsg
  âŒ½âŒ¾(â¥Šâˆ˜(<Ë˜)âˆ˜â€¿8âŠ¸â¥Š)Â¨abcd
}

Md5 â† âˆ¾ToStringÂ¨âˆ˜ToMd5

!"d41d8cd98f00b204e9800998ecf8427e"â‰¡ Md5 ""
!"0cc175b9c0f1b6a831c399e269772661"â‰¡ Md5 "a"
!"900150983cd24fb0d6963f7d28e17f72"â‰¡ Md5 "abc"
!"f96b697d7cb7938d525a2f31aaf161d0"â‰¡ Md5 "message digest"
!"c3fcd3d76192e4007dfb496cca67e13b"â‰¡ Md5 "abcdefghijklmnopqrstuvwxyz"
!"d174ab98d277d9f5a5611c2c9f419d9f"â‰¡ Md5 "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
!"57edf4a22be3c955ac49da2e2107b67a"â‰¡ Md5 "12345678901234567890123456789012345678901234567890123456789012345678901234567890"

# â€¢Show ((âˆ¾âŸœ(8âŠ¸Ã—)â‰ )âŠ¸â‹ˆ(â‰â—‹â‹ˆ)Md5)"message digest"
# â€¢Show ((âˆ¾âŸœ(8âŠ¸Ã—)â‰ )âŠ¸â‹ˆ(â‰â—‹â‹ˆ)Md5)"abcdefghijklmnopqrstuvwxyz"
# â€¢Show ((âˆ¾âŸœ(8âŠ¸Ã—)â‰ )âŠ¸â‹ˆ(â‰â—‹â‹ˆ)Md5)"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
