#!/usr/bin/env cbqn
envâ†{vâ‡â‰>âŠ‘âˆ˜âŠâŸœ'='âŠ¸(â†‘â‹ˆ1âŠ¸â†“âˆ˜â†“)Â¨{-Â¬(Â¬Ã—1++`)ğ•©=@+10}âŠ¸âŠ”1âŠ‘â€¢SH<"env"â‹„Varâ‡{âŠâŸœğ•©âŠ¸âŠâŸœ(âˆ¾âŸœğ•¨)Ëv}}
util â† â€¢Import "/util.bqn"âˆ¾Ëœ"." env.VarâŒ¾â‹ˆ "BQN_LIB"
âŸ¨md5âŸ© â‡

Encode8 â† {âŸ¨8â€¿'u',1â€¿'u'âŸ©â€¢bit._cast ğ•©}
Encode32 â† {âˆ¾âŒ½(âŒ½âˆ˜(8âŠ¸â†‘)âˆ˜(âŸ¨16â€¿'u',1â€¿'u'âŸ©â€¢bit._cast)âˆ˜â‹ˆ)Â¨{ğ•©+16Ã—ğ•¨}Â´Ë˜âˆ˜â€¿2â¥Š"0123456789ABCDEF"âŠğ•©}
# Encode32 â† {âˆ¾âŒ½(Â¯4âŠ¸â†“âˆ˜(âŸ¨8â€¿'u',1â€¿'u'âŸ©â€¢bit._cast)âˆ˜â‹ˆ)Â¨"0123456789ABCDEF"âŠğ•©}
# "# encode32 8FFF0000" util.Debug Encode32 "8FFF0000"
ToString â† {
  â¥Š((âŠ‘âŸœ"0123456789abcdef"Â¨Â·â€¢ShowÂ·16âŠ¸(âŒŠâˆ˜(Ã·Ëœ)â‹ˆ|)Â·â€¢ShowÂ·{ğ•¨+2Ã—ğ•©}Â´Â·âŒ½Â·â€¢Show>)Ë˜Â·âŒ½Â·â¥ŠÂ·<Ë˜âˆ˜â€¿8âŠ¸â¥Š)ğ•©
  # ((âŠ‘âŸœ"0123456789abcdef"{ğ•¨+2Ã—ğ•©}Â´)Ë˜Â·âŒ½âˆ˜â€¿4âŠ¸â¥Š)ğ•©
  # âˆ¾((âŠ‘âŸœ"0123456789abcdef"Â·{ğ•¨+2Ã—ğ•©}Â´âŒ½)Ë˜âˆ˜â€¿4âŠ¸â¥Š)ğ•©
  # âŠ‘âŸœ"0123456789abcdef"Â¨âˆ¾((16âŠ¸(âŒŠÃ·Ëœ))â‹ˆ(16âŠ¸|))Â¨256|256+âˆ¾âŸ¨1â€¿'u',8â€¿'u'âŸ©â€¢bit._castÂ¨ğ•©
}
"ToString encode32 D76AA478" util.Debug ToString Encode32 "D76AA478"
t â† Encode32Â¨âŸ¨
  "00000000"
  "D76AA478","E8C7B756","242070DB","C1BDCEEE"
  "F57C0FAF","4787C62A","A8304613","FD469501"
  "698098D8","8B44F7AF","FFFF5BB1","895CD7BE"
  "6B901122","FD987193","A679438E","49B40821"
  "F61E2562","C040B340","265E5A51","E9B6C7AA"
  "D62F105D","02441453","D8A1E681","E7D3FBC8"
  "21E1CDE6","C33707D6","F4D50D87","455A14ED"
  "A9E3E905","FCEFA3F8","676F02D9","8D2A4C8A"
  "FFFA3942","8771F681","6D9D6122","FDE5380C"
  "A4BEEA44","4BDECFA9","F6BB4B60","BEBFBC70"
  "289B7EC6","EAA127FA","D4EF3085","04881D05"
  "D9D4D039","E6DB99E5","1FA27CF8","C4AC5665"
  "F4292244","432AFF97","AB9423A7","FC93A039"
  "655B59C3","8F0CCC92","FFEFF47D","85845DD1"
  "6FA87E4F","FE2CE6E0","A3014314","4E0811A1"
  "F7537E82","BD3AF235","2AD7D2BB","EB86D391"
âŸ©
"# ToString encode32 8FFF0000" util.Debug ToString Encode32 "8FFF0000"
aâ€¿bâ€¿câ€¿d â† Encode32Â¨âŸ¨"67452301","EFCDAB89","98BADCFE","10325476"âŸ©
P32 â† {
  ğ•Š ğ•© : {ğ•¨+2Ã—ğ•©}Â´âˆ˜âŒ½Ë˜(âˆ˜â€¿8âŠ¸â¥Š)ğ•© ; # âŒ½â‰1âŒ¾
  # ğ•Š ğ•© : (2â‹†8)|(2â‹†8)+âŸ¨1,8â€¿'u'âŸ©â€¢bit._cast âŒ½â‰1âŒ¾(âˆ˜â€¿4âŠ¸â¥Š)ğ•© ;
  # ğ•Šâ¼ğ•© : âˆ¾âŒ½<Ë˜âˆ˜â€¿8â¥Šğ•© 
  ğ•Šâ¼ğ•© : âˆ¾(8â†‘(16â€¿1â€¢bit._cast)âˆ˜â‹ˆ)Â¨âŒ½ğ•©
  # ğ•Šâ¼ğ•© : âˆ¾(8â†‘(16â€¿1â€¢bit._cast)âˆ˜â‹ˆ)Â¨ğ•©
}
ToBytes â† {
  ğ•Š ğ•© : <âˆ¾âŒ½<Ë˜âˆ˜â€¿8â¥Šğ•©
}
{
  m â† âŸ¨
    1,0,0,0,1,1,0,0
    1,1,1,0,1,1,1,1
  âŸ©
  # "m" util.Debug m
  # "P32 m" util.Debug P32 m
  # "P32â¼m" util.Debug P32â¼P32 m
  # !mâ‰¡P32â¼P32 m
}
Value32 â† {
  âˆ¾((1â€¿16â€¢bit._cast)âˆ˜â€¢Showâˆ˜(16âŠ¸â†‘))Â¨âŒ½â¥Š<Ë˜âˆ˜â€¿8â¥Šğ•©
}
Md5 â† {
  !âˆ§Â´(255âŠ¸â‰¥-âŸœ@)Â¨message â† ğ•©
  "bitcount" util.Debug msg_len_bits â† 8Ã—â‰ ğ•©
  msg â† âˆ¾{âŒ½âŸ¨8â€¿'u',1â€¿'u'âŸ©â€¢bit._cast â‹ˆğ•©-@}Â¨ğ•©
  "add 1bit" util.Debug msg âˆ¾âŸœâŸ¨1,0,0,0,0,0,0,0âŸ© â†©
  msg â†© {ğ•©âˆ¾Encode8â‹ˆ0}â€¢_while_(448â‰ 512|â‰ )msg
  # "add length" util.Debug msg âˆ¾âŸœ(64â†‘âŸ¨32â€¿'u',1â€¿'u'âŸ©â€¢bit._castâ‹ˆmsg_len_bits) â†©
  "8|count" util.Debug 2âŠ‘{câ€¿vâ€¿l : âŸ¨-Â¬c,vâŒŠâˆ˜Ã·256,lâˆ¾Ëœ256|vâŸ©}â€¢_while_(0<âŠ‘)8â€¿msg_len_bitsâ€¿âŸ¨âŸ©
  "add length" util.Debug msg â†© msg{
    ğ•©âˆ¾âŒ½8â†‘âŸ¨16,1â€¿'u'âŸ©â€¢bit._castâ‹ˆğ•¨
  }Â´2âŠ‘{câ€¿vâ€¿l : âŸ¨-Â¬c,vâŒŠâˆ˜Ã·256,lâˆ¾Ëœ256|vâŸ©}â€¢_while_(0<âŠ‘)8â€¿msg_len_bitsâ€¿âŸ¨âŸ©
  (â‰ msg)!0â‰¡512|â‰ msg
  F â† {xâ€¿yâ€¿z : (x 1â€¿1 â€¢bit._and y) 1â€¿1 â€¢bit._or ((1â€¿1 â€¢bit._not x) 1â€¿1 â€¢bit._and z)}
  G â† {xâ€¿yâ€¿z : (x 1â€¿1 â€¢bit._and z) 1â€¿1 â€¢bit._or (y 1â€¿1 â€¢bit._and (1â€¿1 â€¢bit._not z))}
  H â† {xâ€¿yâ€¿z : x 1â€¿1 â€¢bit._xor y 1â€¿1 â€¢bit._xor z}
  J â† {xâ€¿yâ€¿z : y 1â€¿1 â€¢bit._xor (x 1â€¿1 â€¢bit._or (1â€¿1 â€¢bit._not z))}
  modulo â† 2â‹†8
  Add32 â† {
    "# P32 ğ•¨" util.Debug P32 ğ•¨
    "# P32 ğ•©" util.Debug P32 ğ•©
    "# pairs" util.Debug pairs â† <Ë˜â‰>P32Â¨ğ•¨â€¿ğ•©
    âŠ‘âŸ¨âŸ©â€¿0{wâ€¿x ğ•Š resâ€¿c : val â† c+w+x â‹„ âŸ¨resâˆ¾âŒ½8â†‘âŸ¨16â€¿'u',1â€¿'u'âŸ©â€¢bit._castâŠ‘â€¢ShowâŸ¨â‹ˆmodulo|val,c,w,x,val,9â†‘âŸ¨16â€¿'u',1â€¿'u'âŸ©â€¢bit._castâ‹ˆmodulo|valâŸ©,moduloâ‰¤valâŸ©}Â´âŒ½pairs 
    # âŠ‘âŸ¨âŸ©â€¿0{wâ€¿x ğ•Š resâ€¿c : val â† c+w+x â‹„ âŸ¨resâˆ¾Ëœ8â†‘â€¢ShowâŸ¨16â€¿'u',1â€¿'u'âŸ©â€¢bit._castâŠ‘â€¢ShowâŸ¨â‹ˆmodulo|val,c,w,x,valâŸ©,moduloâ‰¤valâŸ©}Â´pairs 
  }
  Add32s â† {ğ•¨ âŸ¨32,1âŸ©â€¢bit._add ğ•©}
  # Add32 â† {âŸ¨32,1âŸ©â€¢bit._cast ğ•¨+â—‹(âŸ¨1,32â€¿'u'âŸ©â€¢bit._cast)ğ•©}
  abcd â† aâ€¿bâ€¿câ€¿d{block ğ•Š aâ€¿bâ€¿câ€¿d :
    "block" util.Debug ><Ë˜âˆ˜â€¿32â¥Šblock
    "word_block" util.Debug >word_block â† â¥Š<Ë˜âˆ˜â€¿32â¥Šblock
    # "word_block" util.Debug >word_block â† ToBytesË˜âˆ˜â€¿32â¥Šblock
    "valueâŠ‘word_block" util.Debug Value32 âŠ‘word_block
    # "new word_block" util.Debug word_block â† (<âŒ½âŒ¾P32)Ë˜âˆ˜â€¿32â¥Šblock
    # "new word_block" util.Debug word_block â† (<Â·â¥ŠÂ·âŒ½4â€¿8âŠ¸â¥Š)Ë˜âˆ˜â€¿32â¥Šblock
    aaâ€¿bbâ€¿ccâ€¿dd â† aâ€¿bâ€¿câ€¿d
    "p32" util.Debug >P32Â¨aâ€¿b 
    "trans" util.Debug <Ë˜â‰>P32Â¨aâ€¿b 
    "aâ€¿b" util.Debug aâ‰b
    "a+b" util.Debug a Add32 b
    Op1 â† {bâ€¿câ€¿dâ€¿kâ€¿sâ€¿i ğ•Š a : b Add32(sâŠ¸âŒ½)âŒ¾(âˆ¾Â·âŒ½Â·â¥ŠÂ·<Ë˜âˆ˜â€¿8âŠ¸â¥Š)a Add32(F bâ€¿câ€¿d)Add32(kâŠ‘word_block)Add32 iâŠ‘t}
    "a+f" util.Debug a Add32(F bâ€¿câ€¿d)
    "ToString a+f" util.Debug ToString a Add32(F bâ€¿câ€¿d)

    "0âŠ‘X" util.Debug (0âŠ‘word_block)
    "ToString 0âŠ‘X" util.Debug ToString(0âŠ‘word_block)
    # "ToString X" util.Debug ToStringâ‹ˆâ€¢ShowâŒ½âŒ¾P32(0âŠ‘word_block)
    "P32 0âŠ‘X" util.Debug P32(0âŠ‘word_block)

    "14âŠ‘X" util.Debug (14âŠ‘word_block)
    "ToString 14âŠ‘X" util.Debug ToString(14âŠ‘word_block)
    "P32 14âŠ‘X" util.Debug P32(14âŠ‘word_block)

    "a+f+X" util.Debug tt â† (0âŠ‘word_block)Add32 a Add32(F bâ€¿câ€¿d)
    "ToString a+f+X" util.Debug ToString tt
    "1âŠ‘t" util.Debug ToString(1âŠ‘t)
    "a+f+X+T" util.Debug ToString a Add32(F bâ€¿câ€¿d)Add32(0âŠ‘word_block)Add32 1âŠ‘t
    "rotated" util.Debug ToString(7âŠ¸âŒ½)âŒ¾(âˆ¾Â·âŒ½Â·â¥ŠÂ·<Ë˜âˆ˜â€¿8âŠ¸â¥Š)â€¢Show a Add32(F bâ€¿câ€¿d)Add32(0âŠ‘word_block)Add32 1âŠ‘t
    a bâ€¿câ€¿dâ€¿00â€¿07â€¿01âŠ¸Op1 â†©
    ("step1 of "âˆ¾message) util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    d aâ€¿bâ€¿câ€¿01â€¿12â€¿02âŠ¸Op1 â†©
    c dâ€¿aâ€¿bâ€¿02â€¿17â€¿03âŠ¸Op1 â†©
    b câ€¿dâ€¿aâ€¿03â€¿22â€¿04âŠ¸Op1 â†©
    ("step4 of "âˆ¾message) util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    a bâ€¿câ€¿dâ€¿04â€¿07â€¿05âŠ¸Op1 â†©
    d aâ€¿bâ€¿câ€¿05â€¿12â€¿06âŠ¸Op1 â†©
    c dâ€¿aâ€¿bâ€¿06â€¿17â€¿07âŠ¸Op1 â†©
    b câ€¿dâ€¿aâ€¿07â€¿22â€¿08âŠ¸Op1 â†©
    ("step8 of "âˆ¾message) util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    a bâ€¿câ€¿dâ€¿08â€¿07â€¿09âŠ¸Op1 â†©
    d aâ€¿bâ€¿câ€¿09â€¿12â€¿10âŠ¸Op1 â†©
    c dâ€¿aâ€¿bâ€¿10â€¿17â€¿11âŠ¸Op1 â†©
    b câ€¿dâ€¿aâ€¿11â€¿22â€¿12âŠ¸Op1 â†©
    ("stepC of "âˆ¾message) util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    a bâ€¿câ€¿dâ€¿12â€¿07â€¿13âŠ¸Op1 â†©
    ("stepD of "âˆ¾message) util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    d aâ€¿bâ€¿câ€¿13â€¿12â€¿14âŠ¸Op1 â†©
    ("stepE of "âˆ¾message) util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    "14âŠ‘x" util.Debug (14âŠ‘word_block)
    "ToString 14âŠ‘X" util.Debug ToString(14âŠ‘word_block)
    "15âŠ‘t" util.Debug ToString 15âŠ‘t
    c dâ€¿aâ€¿bâ€¿14â€¿17â€¿15âŠ¸Op1 â†©
    "ToString C" util.Debug ToString c
    "C" util.Debug c
    ("stepF of "âˆ¾message) util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    b câ€¿dâ€¿aâ€¿15â€¿22â€¿16âŠ¸Op1 â†©
    "B" util.Debug ToString b
    "phase1" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    Op2 â† {bâ€¿câ€¿dâ€¿kâ€¿sâ€¿i ğ•Š a : b Add32 (sâŠ¸âŒ½)âŒ¾(âˆ¾Â·âŒ½Â·â¥ŠÂ·<Ë˜âˆ˜â€¿8âŠ¸â¥Š)a Add32(G bâ€¿câ€¿d)Add32(kâŠ‘word_block)Add32 iâŠ‘t}
    a bâ€¿câ€¿dâ€¿01â€¿05â€¿17âŠ¸Op2 â†©
    ("step1 of "âˆ¾message) util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d
    d aâ€¿bâ€¿câ€¿06â€¿09â€¿18âŠ¸Op2 â†©
    c dâ€¿aâ€¿bâ€¿11â€¿14â€¿19âŠ¸Op2 â†©
    b câ€¿dâ€¿aâ€¿00â€¿20â€¿20âŠ¸Op2 â†©

    a bâ€¿câ€¿dâ€¿05â€¿05â€¿21âŠ¸Op2 â†©
    d aâ€¿bâ€¿câ€¿10â€¿09â€¿22âŠ¸Op2 â†©
    c dâ€¿aâ€¿bâ€¿15â€¿14â€¿23âŠ¸Op2 â†©
    b câ€¿dâ€¿aâ€¿04â€¿20â€¿24âŠ¸Op2 â†©

    a bâ€¿câ€¿dâ€¿09â€¿05â€¿25âŠ¸Op2 â†©
    d aâ€¿bâ€¿câ€¿14â€¿09â€¿26âŠ¸Op2 â†©
    c dâ€¿aâ€¿bâ€¿03â€¿14â€¿27âŠ¸Op2 â†©
    b câ€¿dâ€¿aâ€¿08â€¿20â€¿28âŠ¸Op2 â†©

    a bâ€¿câ€¿dâ€¿13â€¿05â€¿29âŠ¸Op2 â†©
    d aâ€¿bâ€¿câ€¿02â€¿09â€¿30âŠ¸Op2 â†©
    c dâ€¿aâ€¿bâ€¿07â€¿14â€¿31âŠ¸Op2 â†©
    b câ€¿dâ€¿aâ€¿12â€¿20â€¿32âŠ¸Op2 â†©
    "phase2" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    Op3 â† {bâ€¿câ€¿dâ€¿kâ€¿sâ€¿i ğ•Š a : b Add32 (sâŠ¸âŒ½)âŒ¾(âˆ¾Â·âŒ½Â·â¥ŠÂ·<Ë˜âˆ˜â€¿8âŠ¸â¥Š)a Add32(H bâ€¿câ€¿d)Add32(kâŠ‘word_block)Add32 iâŠ‘t}
    a bâ€¿câ€¿dâ€¿05â€¿04â€¿33âŠ¸Op3 â†©
    d aâ€¿bâ€¿câ€¿08â€¿11â€¿34âŠ¸Op3 â†©
    c dâ€¿aâ€¿bâ€¿11â€¿16â€¿35âŠ¸Op3 â†©
    b câ€¿dâ€¿aâ€¿14â€¿23â€¿36âŠ¸Op3 â†©

    a bâ€¿câ€¿dâ€¿01â€¿04â€¿37âŠ¸Op3 â†©
    d aâ€¿bâ€¿câ€¿04â€¿11â€¿38âŠ¸Op3 â†©
    c dâ€¿aâ€¿bâ€¿07â€¿16â€¿39âŠ¸Op3 â†©
    b câ€¿dâ€¿aâ€¿10â€¿23â€¿40âŠ¸Op3 â†©

    a bâ€¿câ€¿dâ€¿13â€¿04â€¿41âŠ¸Op3 â†©
    d aâ€¿bâ€¿câ€¿00â€¿11â€¿42âŠ¸Op3 â†©
    c dâ€¿aâ€¿bâ€¿03â€¿16â€¿43âŠ¸Op3 â†©
    b câ€¿dâ€¿aâ€¿06â€¿23â€¿44âŠ¸Op3 â†©

    a bâ€¿câ€¿dâ€¿09â€¿04â€¿45âŠ¸Op3 â†©
    d aâ€¿bâ€¿câ€¿12â€¿11â€¿46âŠ¸Op3 â†©
    c dâ€¿aâ€¿bâ€¿15â€¿16â€¿47âŠ¸Op3 â†©
    b câ€¿dâ€¿aâ€¿02â€¿23â€¿48âŠ¸Op3 â†©

    Op4 â† {bâ€¿câ€¿dâ€¿kâ€¿sâ€¿i ğ•Š a : b Add32 (sâŠ¸âŒ½)âŒ¾(âˆ¾Â·âŒ½Â·â¥ŠÂ·<Ë˜âˆ˜â€¿8âŠ¸â¥Š)a Add32(J bâ€¿câ€¿d)Add32(kâŠ‘word_block)Add32 iâŠ‘t}
    a bâ€¿câ€¿dâ€¿00â€¿06â€¿49âŠ¸Op4 â†©
    d aâ€¿bâ€¿câ€¿07â€¿10â€¿50âŠ¸Op4 â†©
    c dâ€¿aâ€¿bâ€¿14â€¿15â€¿51âŠ¸Op4 â†©
    b câ€¿dâ€¿aâ€¿05â€¿21â€¿52âŠ¸Op4 â†©

    a bâ€¿câ€¿dâ€¿12â€¿06â€¿53âŠ¸Op4 â†©
    d aâ€¿bâ€¿câ€¿03â€¿10â€¿54âŠ¸Op4 â†©
    c dâ€¿aâ€¿bâ€¿10â€¿15â€¿55âŠ¸Op4 â†©
    b câ€¿dâ€¿aâ€¿01â€¿21â€¿56âŠ¸Op4 â†©

    a bâ€¿câ€¿dâ€¿08â€¿06â€¿57âŠ¸Op4 â†©
    d aâ€¿bâ€¿câ€¿15â€¿10â€¿58âŠ¸Op4 â†©
    c dâ€¿aâ€¿bâ€¿06â€¿15â€¿59âŠ¸Op4 â†©
    b câ€¿dâ€¿aâ€¿13â€¿21â€¿60âŠ¸Op4 â†©

    a bâ€¿câ€¿dâ€¿04â€¿06â€¿61âŠ¸Op4 â†©
    d aâ€¿bâ€¿câ€¿11â€¿10â€¿62âŠ¸Op4 â†©
    c dâ€¿aâ€¿bâ€¿02â€¿15â€¿63âŠ¸Op4 â†©
    b câ€¿dâ€¿aâ€¿09â€¿21â€¿64âŠ¸Op4 â†©
    "phase4" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d

    a aaâŠ¸Add32 â†©
    b bbâŠ¸Add32 â†©
    c ccâŠ¸Add32 â†©
    d ddâŠ¸Add32 â†©
    "phase5" util.Debug ToStringÂ¨ aâ€¿bâ€¿câ€¿d 
    "P32" util.Debug P32Â¨ aâ€¿bâ€¿câ€¿d

    âŒ½âŒ¾(â¥Šâˆ˜(<Ë˜)âˆ˜â€¿8âŠ¸â¥Š)Â¨aâ€¿bâ€¿câ€¿d
  }Â´<Ë˜âˆ˜â€¿512â¥Šmsg
}

# â€¢Show P32Â¨ kâ† Md5 ""
# â€¢Show ToString (âŒ½âŒ¾P32)Â¨k
# â€¢Show ToString (âŒ½âŒ¾P32)Â¨Md5 "a"
â€¢Show ToStringÂ¨Md5 ""
