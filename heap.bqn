#
# O(log(N)) heap constructed from order function: version 0.2.0
#
# Note
# A heap is created from a comparing _dyadic_ function.
# So if, for example, you want to compare the first elements, use `Over` like:
#
#  H â† (â‰¤â—‹âŠ‘)_to_heap
#
# You can write as follow, but this is more expensive to compare all elements:
#
#  H â† (âŠ‘â‰¤)_to_heap
#
# And you will get a rank error by:
#
#  H â† (â‰¤âŠ‘)_to_heap
#

Parent â† 2âŒŠâˆ˜Ã·ËœÂ¯1âŠ¸+
Children â† Â¯1â€¿0+2Ã—1âŠ¸+

_to_heap â‡ {ğ”½_ğ•£ :
  l â† âŸ¨âŸ©
  Ord â† ğ”½
  Dump â‡ {ğ•¤ â‹„ l}
  Push â‡ {k â† â‰ l â‹„ l âˆ¾âŸœâŸ¨ğ•©âŸ© â†© â‹„ ShiftUp k}
  ShiftUp â† {
    {ğ•Š n :
      OrdÂ´ câ€¿p â† âŸ¨nâŠ‘l,(m â† Parent n)âŠ‘lâŸ© ?
      # l (pâŒ¾(nâŠ¸âŠ‘)câŒ¾(mâŠ¸âŠ‘)) â†©
      l âŒ½âŒ¾(nâ€¿mâŠ¸âŠ) â†©
      m ;
      0
    }â€¢_while_(0âŠ¸<)ğ•©
  }
  Empty â‡ {ğ•¤ â‹„ 0=â‰ l}
  Peek â‡ {ğ•¤ â‹„ âŠ‘l}
  Pop â‡ {ğ•¤ â‹„ n â† Â¯1+â‰ l â‹„ vâ€¿u â† âŸ¨âŠ‘l,nâŠ‘lâŸ© â‹„ l uâŒ¾âŠ‘ â†© â‹„ ShiftDown 0 â‹„ l nâŠ¸â†‘ â†© â‹„ v}
  ShiftDown â† {ğ•Š m :
    len â† â‰ l
    {ğ•Š m :
      n1â€¿n2 â† Children m
      {
        lenâ‰¤n1 ? len ;
        n â† {len=1+n1 ? n1 ; (OrdÂ´n1â€¿n2âŠl)â—¶âŸ¨n2,n1âŸ©@}
        # This two phase update is much faster than `l âŒ½âŒ¾(nâ€¿mâŠ¸âŠ) â†©`
        xâ€¿y â† âŸ¨nâŠ‘l,mâŠ‘lâŸ©
        l (yâŒ¾(nâŠ¸âŠ‘)xâŒ¾(mâŠ¸âŠ‘)) â†©
        n
      }
    }â€¢_while_(lenâŠ¸>)m
  }
}
